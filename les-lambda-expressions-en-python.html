<!DOCTYPE html>
<html lang="fr">

<head>
        <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Les lambda expressions en python</title>

    <link href="https://steampunkislande.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
        title="Let's tame that python together Full Atom Feed" />
    <link href="https://steampunkislande.github.io/feeds/{slug}.atom.xml" type="application/atom+xml"
        rel="alternate" title="Let's tame that python together Categories Atom Feed" />
    <!-- Bootstrap Core CSS -->
    <link href="https://steampunkislande.github.io/theme/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="https://steampunkislande.github.io/theme/css/clean-blog.min.css" rel="stylesheet">

    <!-- Personal CSS for nice table -->
    <link href="https://steampunkislande.github.io/theme/css/tableau.css" rel="stylesheet">

    <!-- CSS for markdown-fenced-blocks -->
    <link href="https://steampunkislande.github.io/theme/css/code-tab.css" rel="stylesheet">

    <!-- Code highlight color scheme -->
    <link href="https://steampunkislande.github.io/theme/css/code_blocks/darkly.css" rel="stylesheet">


    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
        type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet'
        type='text/css'>
    <link
        href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
        rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Les lambda expressions en python Ceci est le premier article de mon blog, et aujourd'hui je voulais vous partager mon expérience avec...">

        <meta name="author" content="Charles Monod-Broca">

        <meta name="tags" content="lambda">
        <meta name="tags" content="common issues">

	    <meta property="og:locale" content="">
    <meta property="og:site_name" content="Let's tame that python together">

	<meta property="og:type" content="article">
            <meta property="article:author" content="https://steampunkislande.github.io/author/charles-monod-broca.html">
	<meta property="og:url" content="https://steampunkislande.github.io/les-lambda-expressions-en-python.html">
	<meta property="og:title" content="Les lambda expressions en python">
	<meta property="article:published_time" content="2021-12-25 23:00:00+01:00">
            <meta property="og:description" content="Les lambda expressions en python Ceci est le premier article de mon blog, et aujourd'hui je voulais vous partager mon expérience avec...">

            <meta property="og:image" content="https://steampunkislande.github.io/theme/images/post-bg.jpg">
</head>


    <body class="article-les-lambda-expressions-en-python">

                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                    <div class="container-fluid">
                        <!-- Brand and toggle get grouped for better mobile display -->
                        <div class="navbar-header page-scroll">
                            <button type="button" class="navbar-toggle" data-toggle="collapse"
                                data-target="#bs-example-navbar-collapse-1">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand" href="https://steampunkislande.github.io/">Let's tame that python together</a>
                        </div>

                        <!-- Collect the nav links, forms, and other content for toggling -->
                        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                            <ul class="nav navbar-nav navbar-right">

  <li>
                                    <a href="https://steampunkislande.github.io/pages/a-propos.html">À propos</a></li>
                            </ul>
                        </div>
                        <!-- /.navbar-collapse -->
                    </div>
                    <!-- /.container -->
                </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('https://steampunkislande.github.io/theme/images/post-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Les lambda expressions en python</h1>
                        <span class="meta">Posted by
                                <a href="https://steampunkislande.github.io/author/charles-monod-broca.html">Charles Monod-Broca</a>
                             on sam. 25 décembre 2021
                        </span>
                            <span class="meta">Updated on mar. 28 décembre 2021</span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

                <!-- Main Content -->
                <div class="container">
                    <div class="row">
                        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <h1>Les lambda expressions en python</h1>
<p>Ceci est le premier article de mon blog, et aujourd'hui je voulais vous partager mon expérience avec les lambda expressions en python.</p>
<h2>Présentation</h2>
<p>Cette syntaxe très pratique permet de créer des objets "appelables" sans définir une fonction entière, pour peu que le code a exécuter tienne en une ligne.</p>
<p>Exemple, avec une fonction qui renvoie deux fois la valeur de son unique paramètre. Avec une fonction:</p>
<p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>f</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
    <span class=k>return</span> <span class=mi>2</span><span class=o>*</span><span class=n>x</span>
</code></pre></div></p>
<p>Avec une lambda expression:</p>
<p> <div class=highlight><pre><span></span><code><span class=n>f</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span><span class=mi>2</span><span class=o>*</span><span class=n>x</span>
</code></pre></div></p>
<p>Quelques différences:</p>
<ul>
<li>La lambda expression tient en une seule ligne (alors que définir une fonction demande toujours au minimum deux lignes)</li>
<li>Dans une lambda expression, pas de mot-clé return: le résultat à droite des <code>:</code> <strong>est</strong> sa valeur de retour. Plus simple ;)</li>
</ul>
<p>Pour utiliser une lambda expression, pas besoin de lui donner un nom: on peut simplement la définir, et la passer en paramètre d'une fonction sans jamais la nommer. C'est pourquoi elles sont souvent appelées fonctions anonymes dans la littérature. Cependant, pas de nom à la déclaration ne veut pas dire pas de nom tout court: il faut de toutes façons lui associer une variable ne serait-ce que pour y faire référence. Donc une fonction qui prend un appelable en paramètre, si on lui passe une lambda, elle y fera référence par le nom du paramètre concerné (voir exemple ci-dessous).</p>
<h2>À quoi servent-elles ?</h2>
<p>Le cas typique, c'est quand on travaille avec des itérables (liste, tuple, dictionnaire, générateur...).</p>
<p>Prenons cette liste: <code>l = [("Alice",45), ("Bob",30), ("Charles",12)]</code>.
Chaque élément de cette liste est un tuple, sous la forme <code>(Prénom, Âge)</code>. </p>
<p>Mais comment trier cette liste ? Si on ne précise pas, python s'en sort quand même:</p>
<p> <div class=highlight><pre><span></span><code><span class=n>l</span> <span class=o>=</span> <span class=p>[(</span><span class=s2>&quot;Charles&quot;</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;Bob&quot;</span><span class=p>,</span><span class=mi>3</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;Alice&quot;</span><span class=p>,</span><span class=mi>4</span><span class=p>)]</span>
<span class=nb>sorted</span><span class=p>(</span><span class=n>l</span><span class=p>)</span>
</code></pre></div></p>
<p>Résultat:</p>
<p> <div class=highlight><pre><span></span><code><span class=p>[(</span><span class=s1>&#39;Alice&#39;</span><span class=p>,</span> <span class=mi>4</span><span class=p>),</span> <span class=p>(</span><span class=s1>&#39;Bob&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span> <span class=p>(</span><span class=s1>&#39;Charles&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)]</span>
</code></pre></div></p>
<p>Comme vous pouvez constater, la liste est triée uniquement selon le premier élément de chaque tuple.
Et en cas d'égalité (par exemple si on compare (0,10) et (0,5)), python compare le champ suivant de chaque élément à départager. Dans le cas où on veut comparer (0,10) à (0,5), cela revient à comparer 10 et 5.</p>
<p>Mais que viennent faire les lambdas dans tout ça ? Eh bien, si vous voulez trier selon le second élément uniquement, il suffit de passer un "appelable" à la fonction sorted. Voyez plutôt:</p>
<p> <div class=highlight><pre><span></span><code><span class=n>l</span> <span class=o>=</span> <span class=p>[(</span><span class=s2>&quot;Charles&quot;</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;Bob&quot;</span><span class=p>,</span><span class=mi>3</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;Alice&quot;</span><span class=p>,</span><span class=mi>4</span><span class=p>)]</span>
<span class=nb>sorted</span><span class=p>(</span><span class=n>l</span><span class=p>,</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>e</span><span class=p>:</span><span class=n>e</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</code></pre></div></p>
<p>Résultat:</p>
<p> <div class=highlight><pre><span></span><code><span class=p>[(</span><span class=s1>&#39;Charles&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=s1>&#39;Bob&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span> <span class=p>(</span><span class=s1>&#39;Alice&#39;</span><span class=p>,</span> <span class=mi>4</span><span class=p>)]</span>
</code></pre></div></p>
<p>Ici, on a passé une lambda expression à la fonction <code>sorted</code>. Cette dernière va donc utiliser cet "appelable" comme clé pour comparer les éléments de l.
L'idée est que <code>sorted</code> va appeler son paramètre <code>key</code> à chaque fois qu'elle aura besoin de comparer deux éléments. Elle appellera cette fonction avec l'élément "brut" en paramètre, en s'attendant à recevoir une valeur qui lui permettra de réellement comparer les éléments entre eux.</p>
<p>On aurait tout à fait pu passer par une fonction d'ailleurs. Et pour voir ce qui se passe derrière tout ça, je vous propose cette fonction un peu bavarde:</p>
<p> <div class=highlight><pre><span></span><code><span class=k>def</span> <span class=nf>my_key</span><span class=p>(</span><span class=n>element</span><span class=p>):</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Fonction key appelée avec &quot;</span><span class=p>,</span><span class=n>element</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>element</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

<span class=n>l</span> <span class=o>=</span> <span class=p>[(</span><span class=s2>&quot;Charles&quot;</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;Bob&quot;</span><span class=p>,</span><span class=mi>3</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;Alice&quot;</span><span class=p>,</span><span class=mi>4</span><span class=p>)]</span>
<span class=nb>sorted</span><span class=p>(</span><span class=n>l</span><span class=p>,</span><span class=n>key</span><span class=o>=</span><span class=n>my_key</span><span class=p>)</span>
</code></pre></div></p>
<p>Cette fonction le dit à chaque fois qu'elle est appelée, ce qui nous permet de suivre son utilisation.</p>
<p>Résultat:</p>
<p> <div class=highlight><pre><span></span><code><span class=n>Fonction</span> <span class=n>key</span> <span class=n>appelée</span> <span class=n>avec</span>  <span class=p>(</span><span class=s1>&#39;Charles&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
<span class=n>Fonction</span> <span class=n>key</span> <span class=n>appelée</span> <span class=n>avec</span>  <span class=p>(</span><span class=s1>&#39;Bob&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<span class=n>Fonction</span> <span class=n>key</span> <span class=n>appelée</span> <span class=n>avec</span>  <span class=p>(</span><span class=s1>&#39;Alice&#39;</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
<span class=n>Sortie</span><span class=p>:</span> <span class=p>[(</span><span class=s1>&#39;Alice&#39;</span><span class=p>,</span> <span class=mi>4</span><span class=p>),</span> <span class=p>(</span><span class=s1>&#39;Bob&#39;</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span> <span class=p>(</span><span class=s1>&#39;Charles&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)]</span>
</code></pre></div></p>
<p>Comme vous pouvez l'observer, le paramètre <code>key</code> est appelé pour chaque élément de la liste. Bien sûr, si la liste est plus longue, la fonction sera appelée à chaque fois qu'une comparaison sera nécessaire, et le nombre d'appels dépendra directement de la complexité algorithmique de la fonction de tri. Mais ce n'est pas le sujet de cet article !</p>
<h2>Les erreurs que vous pourriez rencontrer...</h2>
<p>Maintenant que vous savez comment utiliser une lambda expression, vous allez probablement vouloir en mettre partout. Malheureusement, dans certains cas, vous pourriez vous retrouver avec un résultat complètement inattendu. Mieux vaut prévenir que guérir, donc. Et voici une situation typique dont j'ai pu faire les frais en participant au développement de cutevariant.</p>
<p>Considérez ce morceau de code en python:</p>
<p> <div class=highlight><pre><span></span><code><span class=c1># Déclarer un dictionnaire vide</span>
<span class=n>d</span> <span class=o>=</span> <span class=p>{}</span>
<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
    <span class=c1># Assigne à la clé i une lambda expression qui affiche i.</span>
    <span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span><span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</code></pre></div></p>
<p>Que fait ce code, et pourquoi ne ferait-il pas ce qu'on attend de lui ?
À première vue, d est un dictionnaire dont les clés sont des entiers (de 0 à 9), et les valeurs de simples lambda expressions. Intuitivement, on pourrait penser que <code>print(i)</code> devrait afficher la même valeur que la clé à laquelle l'expression lambda est associée. Vraiment, il n'y a aucune raison...</p>
<p>Essayons:</p>
<p> <div class=highlight><pre><span></span><code><span class=o>&gt;&gt;&gt;</span> <span class=n>d</span><span class=p>[</span><span class=mi>0</span><span class=p>]()</span>
<span class=mi>9</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>d</span><span class=p>[</span><span class=mi>1</span><span class=p>]()</span>
<span class=mi>9</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>d</span><span class=p>[</span><span class=mi>2</span><span class=p>]()</span>
<span class=mi>9</span>
</code></pre></div></p>
<p>Ce qui s'est passé est plutôt clair, python évalue toutes les lambdas qui font référence à la variable <code>i</code> avec la dernière valeur qu'elle a prise...
Et malheureusement, ce comportement est parfaitement normal pour une simple lambda expression. En effet, en python, les lambda expressions sont incapables de capturer les variables locales au moment de leur déclaration ! Dans notre exemple, tout se passe comme si python évaluait la lambda expression une fois la déclaration terminée. </p>
<p>Mais commment contourner ce problème, me demanderez-vous ?</p>
<h2>... Et comment les corriger</h2>
<p>Reprenons l'exemple plus haut.</p>
<p> <div class=highlight><pre><span></span><code><span class=c1># Déclarer un dictionnaire vide</span>
<span class=n>d</span> <span class=o>=</span> <span class=p>{}</span>
<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
    <span class=c1># Assigne à la clé i une lambda expression qui affiche i.</span>
    <span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span><span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</code></pre></div></p>
<p>En réalité, dans la plupart des cas que j'ai rencontrés, j'avais besoin de garder un registre des "appelables" existants, et de leur dire pourquoi/par qui ils ont été appelés (grâce à un numéro ou à un nom). <code>d</code> sert donc ici de registre dans la démonstration, et la lambda expression est ce fameux "appelable".
Le rôle de <code>d</code> est donc d'associer une clé à un "appelable".</p>
<p>Maintenant, voici une solution possible afin que chaque "appelable" recoive la valeur qui leur est associée.</p>
<p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>functools</span> <span class=kn>import</span> <span class=n>partial</span>
<span class=c1># Déclarer un dictionnaire vide</span>
<span class=n>d</span> <span class=o>=</span> <span class=p>{}</span>
<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
    <span class=c1># Assigne à la clé i une lambda expression qui affiche i.</span>
    <span class=n>d</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>partial</span><span class=p>(</span><span class=k>lambda</span> <span class=n>i</span><span class=p>:</span><span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>),</span><span class=n>i</span><span class=p>)</span>
</code></pre></div></p>
<p>Un <code>partial</code>, c'est un "appelable" qui prépare un appel de fonction. Par exemple, vous voulez capturer la valeur d'une variable locale à un instant t. Mais vous voulez appeler la fonction plus tard. Premier paramètre de partial: la fonction. Chaque argument supplémentaire de partial sera passé en argument à la fonction que vous voulez appeler à la fin. Vous pouvez aussi passez des arguments nommés, dans ce cas l'ordre n'a aucune importance (tant que la fonction à appeler est le premier argument de partial).</p>
<p>Un dessin vaut mieux qu'un long discours:</p>
<p><img alt="How partial is used" src="../images/lambda_expressions_partial.png"></p>
<p>Voilà ! Maintenant, vous savez comment utiliser les lambda expressions et éviter les pièges !
J'espère que cet article vous aura été utile, et si vous avez des questions n'hésitez pas à ouvrir une issue sur <a href="https://github.com/SteampunkIslande/blog/issues" referrerpolicy="no-referrer" rel="noopener noreferrer" target="_blank" title="GitHub">GitHub</a>{target="_blank"} (C'est moins casse-pied que d'installer Disqus, peut-être plus tard).</p>
    </article>

        <div class="tags">
            <p>tags: <a href="https://steampunkislande.github.io/tag/lambda.html">lambda</a>, <a href="https://steampunkislande.github.io/tag/common-issues.html">common issues</a></p>
        </div>

    <hr>

                        </div>
                    </div>
                </div>

                <hr>

                <!-- Footer -->
                <footer>
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                                <ul class="list-inline text-center">
                                    <li>
                                        <a href="#">
                                            <span class="fa-stack fa-lg">
                                                <i class="fa fa-circle fa-stack-2x"></i>
                                                <i class="fa fa-you can add links in your config file fa-stack-1x fa-inverse"></i>
                                            </span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <span class="fa-stack fa-lg">
                                                <i class="fa fa-circle fa-stack-2x"></i>
                                                <i class="fa fa-another social link fa-stack-1x fa-inverse"></i>
                                            </span>
                                        </a>
                                    </li>
                                </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>. <br />        &copy;  Charles Monod-Broca
</p>                            </div>
                        </div>
                    </div>
                </footer>

                <!-- jQuery -->
                <script src="https://steampunkislande.github.io/theme/js/jquery.min.js"></script>

                <!-- Bootstrap Core JavaScript -->
                <script src="https://steampunkislande.github.io/theme/js/bootstrap.min.js"></script>

                <!-- Custom Theme JavaScript -->
                <script src="https://steampunkislande.github.io/theme/js/clean-blog.min.js"></script>

            </body>

</html>